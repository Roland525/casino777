<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Lucky Box Casino ๐ฐ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="authPanel">
    <h1>Lucky Box Casino</h1>
    <input id="nickname" placeholder="ะะฒะตะดะธัะต ะฝะธะบ">
    <button id="loginBtn">ะะพะนัะธ</button>
    <p id="authMsg"></p>
  </div>

  <div id="casino" class="hidden">
    <div class="topbar">
      <span>ะะณัะพะบ: <b id="userDisplay"></b></span>
      <span>ะะฐะปะฐะฝั: <b id="balance"></b></span>
      <button id="logoutBtn">ะัะนัะธ</button>
    </div>

    <div class="tabs">
      <button class="tab" data-game="slots">๐ฐ ะกะปะพัั</button>
      <button class="tab" data-game="blackjack">๐ ะะปัะบะดะถะตะบ</button>
      <button class="tab" data-game="roulette">๐ก ะัะปะตัะบะฐ</button>
      <button class="tab" data-game="mines">๐ฃ ะะธะฝั</button>
    </div>

    <div id="gameArea">
      <button id="playBtn">ะะณัะฐัั</button>
      <p id="gameMsg"></p>
    </div>
  </div>

<script>
let currentUser = null;
const $auth = document.getElementById("authPanel");
const $casino = document.getElementById("casino");
const $bal = document.getElementById("balance");
const $user = document.getElementById("userDisplay");
const $msg = document.getElementById("authMsg");
const $gmsg = document.getElementById("gameMsg");
let currentGame = "slots";

// === ะะฒัะพัะธะทะฐัะธั ===
document.getElementById("loginBtn").addEventListener("click", async () => {
  const name = document.getElementById("nickname").value.trim();
  if (!name) return $msg.textContent = "ะะฒะตะดะธัะต ะฝะธะบ";

  $msg.textContent = "ะัะพะด...";
  const res = await fetch("/api/login", {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name })
  });
  const data = await res.json();
  if (!data.ok) return $msg.textContent = data.error || "ะัะธะฑะบะฐ";
  currentUser = data.user;
  openCasino();
});

function openCasino() {
  $auth.classList.add("hidden");
  $casino.classList.remove("hidden");
  $user.textContent = currentUser.name;
  $bal.textContent = currentUser.balance;
}

// === ะะตัะตะบะปััะตะฝะธะต ะฒะบะปะฐะดะพะบ ===
document.querySelectorAll(".tab").forEach(btn => {
  btn.onclick = () => {
    currentGame = btn.dataset.game;
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    $gmsg.textContent = "ะัะฑัะฐะฝะฐ ะธะณัะฐ: " + btn.textContent;
  };
});

// === ะะณัะฐัั ===
document.getElementById("playBtn").addEventListener("click", async () => {
  if (!currentUser) return;
  $gmsg.textContent = "ะะฐะฟััะบ...";
  const body = { name: currentUser.name, game: currentGame, action: "spin" };
  const res = await fetch("/api/play", {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  });
  const data = await res.json();
  if (data.error) return $gmsg.textContent = data.error;
  if (data.ok) {
    $bal.textContent = data.balance;
    if (data.win > 0) $gmsg.textContent = `๐ ะัะธะณััั: +${data.win}`;
    else $gmsg.textContent = "โ ะัะพะธะณััั";
  }
});

// === ะััะพะด ===
document.getElementById("logoutBtn").onclick = () => location.reload();
</script>
</body>
</html>
